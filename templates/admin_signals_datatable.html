<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Trade Signals DataTable</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .signals-table {
            font-size: 12px;
        }
        .signals-table th,
        .signals-table td {
            padding: 4px 6px;
            vertical-align: middle;
            text-align: center;
        }
        .table-container {
            overflow-x: auto;
        }
        .badge {
            font-size: 10px;
        }
        .text-success { color: #28a745 !important; }
        .text-danger { color: #dc3545 !important; }
        .text-warning { color: #ffc107 !important; }
    </style>
</head>
<body class="bg-light">
    <div class="container-fluid py-3">
        <div class="row">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-signal me-2"></i>Admin Trade Signals
                            <span class="badge bg-info ms-2" id="signalsCount">Loading...</span>
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-container">
                            <table class="table table-hover signals-table mb-0" id="adminSignalsTable">
                                <thead>
                                    <tr>
                                        <th>target_user_id</th>
                                        <th>Symbol</th>
                                        <th>30</th>
                                        <th>DH</th>
                                        <th>Date</th>
                                        <th>Pos</th>
                                        <th>Qty</th>
                                        <th>EP</th>
                                        <th>CMP</th>
                                        <th>%Chan</th>
                                        <th>Inv.</th>
                                        <th>TP</th>
                                        <th>TVA</th>
                                        <th>TPR</th>
                                        <th>PL</th>
                                        <th>ED</th>
                                        <th>PR</th>
                                        <th>PP</th>
                                        <th>IV</th>
                                        <th>IP</th>
                                        <th>NT</th>
                                        <th>Qt</th>
                                        <th>7</th>
                                        <th>%Ch</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data will be loaded via DataTables -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

    <script>
        $(document).ready(function() {
            const table = $('#adminSignalsTable').DataTable({
                processing: true,
                serverSide: true,
                ajax: {
                    url: '/api/datatable/admin-signals',
                    type: 'POST',
                    contentType: 'application/json',
                    data: function(d) {
                        return JSON.stringify(d);
                    }
                },
                columns: [
                    { data: 'target_user_id', name: 'target_user_id' },
                    { data: 'symbol', name: 'symbol' },
                    { data: 'field_30', name: 'field_30', defaultContent: '-' },
                    { data: 'day_high', name: 'day_high', defaultContent: '-' },
                    { data: 'created_date', name: 'created_date' },
                    { data: 'position_type', name: 'position_type' },
                    { data: 'quantity', name: 'quantity' },
                    { data: 'entry_price_formatted', name: 'entry_price' },
                    { data: 'current_price_formatted', name: 'current_price' },
                    { data: 'change_percent_formatted', name: 'change_percent' },
                    { data: 'investment_formatted', name: 'investment' },
                    { data: 'target_price_formatted', name: 'target_price' },
                    { data: 'target_value_achieved', name: 'target_value_achieved', defaultContent: '-' },
                    { data: 'target_percent_return', name: 'target_percent_return', defaultContent: '-' },
                    { data: 'pnl_formatted', name: 'pnl' },
                    { data: 'exit_date', name: 'exit_date', defaultContent: '-' },
                    { data: 'profit_ratio', name: 'profit_ratio', defaultContent: '-' },
                    { data: 'profit_percent', name: 'profit_percent', defaultContent: '-' },
                    { data: 'initial_value', name: 'initial_value', defaultContent: '-' },
                    { data: 'initial_percent', name: 'initial_percent', defaultContent: '-' },
                    { data: 'net_total', name: 'net_total', defaultContent: '-' },
                    { data: 'quote', name: 'quote', defaultContent: '-' },
                    { data: 'field_7', name: 'field_7', defaultContent: '-' },
                    { data: 'percent_change', name: 'percent_change', defaultContent: '-' }
                ],
                pageLength: 25,
                responsive: true,
                scrollX: true,
                order: [[4, 'desc']], // Order by date
                dom: '<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>' +
                     '<"row"<"col-sm-12"tr>>' +
                     '<"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',
                drawCallback: function(settings) {
                    $('#signalsCount').text(settings.json.recordsTotal + ' signals');
                },
                language: {
                    processing: '<i class="fas fa-spinner fa-spin"></i> Loading signals...',
                    emptyTable: 'No admin trade signals found',
                    zeroRecords: 'No matching signals found'
                }
            });

            // Auto refresh every 30 seconds
            setInterval(function() {
                table.ajax.reload(null, false);
            }, 30000);
        });
    </script>
</body>
</html>