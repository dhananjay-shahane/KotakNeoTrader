{% extends "base.html" %}

{% block title %}Trading Signals - Kotak Neo Trading{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h3 mb-1">Trading Signals</h1>
        <p class="text-muted mb-0">Real-time trading signals and market analysis</p>
    </div>
    <div class="d-flex gap-2">
        <button class="btn btn-outline-light" onclick="refreshSignals()">
            <i class="fas fa-sync-alt me-1"></i>Refresh
        </button>
        <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#columnSettingsModal">
            <i class="fas fa-cog me-1"></i>Columns
        </button>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#signalFiltersModal">
            <i class="fas fa-filter me-1"></i>Filters
        </button>
    </div>
</div>

<!-- Signal Summary Cards -->
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="card stats-card border-0 shadow-sm bg-gradient-success">
            <div class="card-body p-3">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title text-uppercase text-white-50 fw-bold mb-1">Long Positions</h6>
                        <h3 class="mb-0 fw-bold text-white" id="buySignalsCount">0</h3>
                        <small class="text-white-50">Active long trades</small>
                    </div>
                    <div class="stats-icon">
                        <i class="fas fa-arrow-up fa-2x text-white"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-3">
        <div class="card stats-card border-0 shadow-sm bg-gradient-danger">
            <div class="card-body p-3">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title text-uppercase text-white-50 fw-bold mb-1">Profitable</h6>
                        <h3 class="mb-0 fw-bold text-white" id="sellSignalsCount">0</h3>
                        <small class="text-white-50">Trades in profit</small>
                    </div>
                    <div class="stats-icon">
                        <i class="fas fa-arrow-down fa-2x text-white"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-3">
        <div class="card stats-card border-0 shadow-sm bg-gradient-warning">
            <div class="card-body p-3">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title text-uppercase text-white fw-bold mb-1">Active Trades</h6>
                        <h3 class="mb-0 fw-bold text-white" id="holdSignalsCount">0</h3>
                        <small class="text-white">Open positions</small>
                    </div>
                    <div class="stats-icon">
                        <i class="fas fa-minus fa-2x text-white"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-3">
        <div class="card stats-card border-0 shadow-sm bg-gradient-info">
            <div class="card-body p-3">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title text-uppercase text-white-50 fw-bold mb-1">Total Holdings</h6>
                        <h3 class="mb-0 fw-bold text-white" id="totalSignalsCount">0</h3>
                        <small class="text-white-50">Last updated: <span id="lastUpdate">--</span></small>
                    </div>
                    <div class="stats-icon">
                        <i class="fas fa-chart-line fa-2x text-white"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Trading Signals Table -->
<div class="row">
    <div class="col-12">
        <div class="card bg-secondary border-0 shadow-lg">
            <div class="card-header bg-dark border-0 d-flex justify-content-between align-items-center">
                <h5 class="mb-0 text-light">
                    <i class="fas fa-signal me-2 text-primary"></i>Trading Signals
                    <span class="badge bg-primary ms-2" id="visibleSignalsCount">0</span>
                </h5>
                <div class="d-flex gap-2">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="autoRefreshToggle" checked>
                        <label class="form-check-label text-light" for="autoRefreshToggle">
                            Auto Refresh
                        </label>
                    </div>
                    <button class="btn btn-sm btn-outline-light" onclick="exportSignals()">
                        <i class="fas fa-download me-1"></i>Export
                    </button>
                </div>
            </div>

            <!-- Summary Row exactly matching Excel -->
            <div class="card-body p-2" style="background: linear-gradient(90deg, #ffc0cb 0%, #87ceeb 8%, #ffa500 16%, #90ee90 24%, #ffb6c1 32%, #98fb98 40%, #d3d3d3 48%, #87ceeb 56%, #ffa500 64%, #90ee90 72%, #ffb6c1 80%, #98fb98 88%, #d3d3d3 96%, #ffc0cb 100%);">
                <div class="d-flex justify-content-between align-items-center text-dark fw-bold" style="font-size: 11px;">
                    <div style="flex: 1; text-align: center; background-color: #ffc0cb; padding: 3px; border-right: 1px solid #fff;">16-Jun</div>
                    <div style="flex: 1; text-align: center; background-color: #87ceeb; padding: 3px; border-right: 1px solid #fff;">DH</div>
                    <div style="flex: 1; text-align: center; background-color: #ffa500; padding: 3px; border-right: 1px solid #fff;">Dow</div>
                    <div style="flex: 1; text-align: center; background-color: #90ee90; padding: 3px; border-right: 1px solid #fff;">Qty</div>
                    <div style="flex: 1; text-align: center; background-color: #ffb6c1; padding: 3px; border-right: 1px solid #fff;">Invested:</div>
                    <div style="flex: 1; text-align: center; background-color: #98fb98; padding: 3px; border-right: 1px solid #fff;">4,600,370</div>
                    <div style="flex: 1; text-align: center; background-color: #d3d3d3; padding: 3px; border-right: 1px solid #fff;">12</div>
                    <div style="flex: 1; text-align: center; background-color: #87ceeb; padding: 3px; border-right: 1px solid #fff;">Signals</div>
                    <div style="flex: 1; text-align: center; background-color: #ffa500; padding: 3px; border-right: 1px solid #fff;">44,392</div>
                    <div style="flex: 1; text-align: center; background-color: #90ee90; padding: 3px; border-right: 1px solid #fff;">TWA</div>
                    <div style="flex: 1; text-align: center; background-color: #ffb6c1; padding: 3px; border-right: 1px solid #fff;">TPR</div>
                    <div style="flex: 1; text-align: center; background-color: #98fb98; padding: 3px; border-right: 1px solid #fff;">ED</div>
                    <div style="flex: 1; text-align: center; background-color: #d3d3d3; padding: 3px; border-right: 1px solid #fff;">EXP</div>
                    <div style="flex: 1; text-align: center; background-color: #87ceeb; padding: 3px; border-right: 1px solid #fff;">PR</div>
                    <div style="flex: 1; text-align: center; background-color: #ffa500; padding: 3px; border-right: 1px solid #fff;">PP</div>
                    <div style="flex: 1; text-align: center; background-color: #90ee90; padding: 3px; border-right: 1px solid #fff;">IV</div>
                    <div style="flex: 1; text-align: center; background-color: #ffb6c1; padding: 3px; border-right: 1px solid #fff;">SI</div>
                    <div style="flex: 1; text-align: center; background-color: #98fb98; padding: 3px;">31,919</div>
                </div>
            </div>

            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-dark table-hover mb-0" id="signalsTable" style="font-size: 10px;">
                        <thead>
                            <tr id="tableHeaders">
                                <th class="text-center" style="width: 80px; background-color: #2d3748; color: white; padding: 6px; border: 1px solid #4a5568;">STF</th>
                                <th class="text-center" style="width: 50px; background-color: #2d3748; color: white; padding: 6px; border: 1px solid #4a5568;">DH</th>
                                <th class="text-center" style="width: 50px; background-color: #2d3748; color: white; padding: 6px; border: 1px solid #4a5568;">Dow</th>
                                <th class="text-center" style="width: 60px; background-color: #2d3748; color: white; padding: 6px; border: 1px solid #4a5568;">Qty</th>
                                <th class="text-center" style="width: 60px; background-color: %Chng; color: white; padding: 6px; border: 1px solid #4a5568;">%Chng</th>
                                <th class="text-center" style="width: 70px; background-color: #2d3748; color: white; padding: 6px; border: 1px solid #4a5568;">CMP</th>
                                <th class="text-center" style="width: 80px; background-color: #2d3748; color: white; padding: 6px; border: 1px solid #4a5568;">Signals</th>
                                <th class="text-center" style="width: 70px; background-color: #2d3748; color: white; padding: 6px; border: 1px solid #4a5568;">TWA</th>
                                <th class="text-center" style="width: 60px; background-color: #2d3748; color: white; padding: 6px; border: 1px solid #4a5568;">TPR</th>
                                <th class="text-center" style="width: 60px; background-color: #2d3748; color: white; padding: 6px; border: 1px solid #4a5568;">PL</th>
                                <th class="text-center" style="width: 70px; background-color: #2d3748; color: white; padding: 6px; border: 1px solid #4a5568;">ED</th>
                                <th class="text-center" style="width: 60px; background-color: #2d3748; color: white; padding: 6px; border: 1px solid #4a5568;">EXP</th>
                                <th class="text-center" style="width: 50px; background-color: #2d3748; color: white; padding: 6px; border: 1px solid #4a5568;">PR</th>
                                <th class="text-center" style="width: 60px; background-color: #2d3748; color: white; padding: 6px; border: 1px solid #4a5568;">PP</th>
                                <th class="text-center" style="width: 70px; background-color: #2d3748; color: white; padding: 6px; border: 1px solid #4a5568;">IV</th>
                                <th class="text-center" style="width: 60px; background-color: #2d3748; color: white; padding: 6px; border: 1px solid #4a5568;">SI</th>
                                <th class="text-center" style="width: 60px; background-color: #2d3748; color: white; padding: 6px; border: 1px solid #4a5568;">%Ch</th>
                            </tr>
                        </thead>
                        <tbody id="signalsTableBody">
                            <!-- Signal data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer bg-dark border-0 d-flex justify-content-between align-items-center text-light">
                <div>
                    <small>Showing <span id="showingCount">0</span> of <span id="totalCount">0</span> signals</small>
                </div>
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-sm btn-outline-light" onclick="previousPage()" id="prevBtn" disabled>
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-light" disabled>
                        Page <span id="currentPage">1</span> of <span id="totalPages">1</span>
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-light" onclick="nextPage()" id="nextBtn" disabled>
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Column Settings Modal -->
<div class="modal fade" id="columnSettingsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark">
            <div class="modal-header border-bottom border-secondary">
                <h5 class="modal-title">
                    <i class="fas fa-cog me-2"></i>Column Settings
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted">Select which columns to display in the trading signals table:</p>
                <div class="row" id="columnCheckboxes">
                    <!-- Column checkboxes will be populated here -->
                </div>
                <hr class="border-secondary">
                <div class="d-flex gap-2">
                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="selectAllColumns()">Select All</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="resetDefaultColumns()">Reset to Default</button>
                </div>
            </div>
            <div class="modal-footer border-top border-secondary">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="applyColumnSettings()">Apply Changes</button>
            </div>
        </div>
    </div>
</div>

<!-- Signal Filters Modal -->
<div class="modal fade" id="signalFiltersModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content bg-dark">
            <div class="modal-header border-bottom border-secondary">
                <h5 class="modal-title">
                    <i class="fas fa-filter me-2"></i>Signal Filters
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Signal Type</label>
                    <select class="form-select bg-secondary text-light" id="signalTypeFilter">
                        <option value="">All Signals</option>
                        <option value="BUY">Buy Signals</option>
                        <option value="SELL">Sell Signals</option>
                        <option value="HOLD">Hold Signals</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Strength</label>
                    <select class="form-select bg-secondary text-light" id="strengthFilter">
                        <option value="">All Strengths</option>
                        <option value="STRONG">Strong</option>
                        <option value="MEDIUM">Medium</option>
                        <option value="WEAK">Weak</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Sector</label>
                    <select class="form-select bg-secondary text-light" id="sectorFilter">
                        <option value="">All Sectors</option>
                        <option value="Banking">Banking</option>
                        <option value="IT">IT Services</option>
                        <option value="Auto">Automobile</option>
                        <option value="Pharma">Pharmaceuticals</option>
                        <option value="FMCG">FMCG</option>
                        <option value="Energy">Energy</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Price Range</label>
                    <div class="row">
                        <div class="col-6">
                            <input type="number" class="form-control bg-secondary text-light" placeholder="Min Price" id="minPriceFilter">
                        </div>
                        <div class="col-6">
                            <input type="number" class="form-control bg-secondary text-light" placeholder="Max Price" id="maxPriceFilter">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-top border-secondary">
                <button type="button" class="btn btn-secondary" onclick="clearFilters()">Clear Filters</button>
                <button type="button" class="btn btn-primary" onclick="applyFilters()" data-bs-dismiss="modal">Apply Filters</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Trading Signals Management
class TradingSignalsManager {
    constructor() {
        this.signals = [];
        this.filteredSignals = [];
        this.currentPage = 1;
        this.pageSize = 20;
        this.autoRefresh = true;
        this.refreshInterval = null;

        this.init();
    }

    init() {
        this.loadSignals();
        this.startAutoRefresh();

        // Event listeners
        document.getElementById('autoRefreshToggle').addEventListener('change', (e) => {
            this.autoRefresh = e.target.checked;
            if (this.autoRefresh) {
                this.startAutoRefresh();
            } else {
                this.stopAutoRefresh();
            }
        });
    }

    async loadSignals() {
        try {
            // Generate sample trading signals data exactly matching Excel format
            this.signals = this.generateExactExcelData();
            this.filteredSignals = [...this.signals];
            this.updateSignalCounts();
            this.renderSignalsTable();
            this.updatePagination();

        } catch (error) {
            console.error('Error loading signals:', error);
            this.showError('Failed to load trading signals');
        }
    }

    generateExactExcelData() {
        // Exact data from Excel image
        return [
            {
                symbol: 'MOEDHUSHEES',
                dh: 227.60,
                dow: 'DH',
                qty: '200',
                change_pct: -1.96,
                cmp: 227.60,
                signals: 223.56,
                twa: '-1.96%',
                tpr: 12.028,
                pl: '-808',
                ed: 44696,
                exp: 2.94,
                pr: 4,
                pp: 669.9,
                iv: 225.4,
                si: -1.96,
                change: -1.96
            },
            {
                symbol: 'TETF',
                dh: 40.38,
                dow: 'DH',
                qty: '500',
                change_pct: -14.32,
                cmp: 47.13,
                signals: 40.38,
                twa: '-14.32%',
                tpr: 23565,
                pl: 52.79,
                ed: 26393,
                exp: -3.375,
                pr: '',
                pp: 7400.8,
                iv: 38.88,
                si: 3.59,
                change: 3.59
            },
            {
                symbol: 'CONSUMBEES',
                dh: 127.2,
                dow: 'DH',
                qty: '100',
                change_pct: 0.00,
                cmp: 127.2,
                signals: 127.2,
                twa: '0.00%',
                tpr: 0.000,
                pl: 0,
                ed: '20-Jan-2025',
                exp: 88.67,
                pr: 198,
                pp: 108.6,
                iv: 127.2,
                si: 2.22,
                change: 0.48
            },
            {
                symbol: 'SILVERBEES',
                dh: 104.25,
                dow: 'DH',
                qty: '1100',
                change_pct: 0.00,
                cmp: 86.85,
                signals: 103.44,
                twa: '0.00%',
                tpr: 103464,
                pl: 0,
                ed: '30-Jan-2025',
                exp: 88.87,
                pr: 198,
                pp: 1009.8,
                iv: 100.90,
                si: 0.48,
                change: 0.48
            }
        ];
    }

    updateSignalCounts() {
        const longPositions = this.filteredSignals.filter(s => parseFloat(s.qty) > 0).length;
        const profitableSignals = this.filteredSignals.filter(s => parseFloat(s.pl) > 0).length;
        const activeSignals = this.filteredSignals.filter(s => parseFloat(s.pl) !== 0).length;

        document.getElementById('buySignalsCount').textContent = longPositions;
        document.getElementById('sellSignalsCount').textContent = profitableSignals;
        document.getElementById('holdSignalsCount').textContent = activeSignals;
        document.getElementById('totalSignalsCount').textContent = this.filteredSignals.length;
        document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
    }

    renderSignalsTable() {
        const tbody = document.getElementById('signalsTableBody');
        const startIndex = (this.currentPage - 1) * this.pageSize;
        const endIndex = startIndex + this.pageSize;
        const pageSignals = this.filteredSignals.slice(startIndex, endIndex);

        tbody.innerHTML = '';

        if (pageSignals.length === 0) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td colspan="17" class="text-center py-4">
                    <i class="fas fa-search fa-3x mb-3 text-muted"></i>
                    <h6 class="text-muted">No signals found</h6>
                    <p class="text-muted mb-0">Try adjusting your filters</p>
                </td>
            `;
            tbody.appendChild(row);
            return;
        }

        pageSignals.forEach(signal => {
            const row = document.createElement('tr');
            row.style.fontSize = '10px';

            // Create cells exactly matching Excel columns
            const columns = [
                { key: 'symbol', style: 'color: #fff; font-weight: bold;' },
                { key: 'dh' },
                { key: 'dow' },
                { key: 'qty' },
                { key: 'change_pct', format: 'percentage' },
                { key: 'cmp', format: 'currency' },
                { key: 'signals', format: 'currency' },
                { key: 'twa' },
                { key: 'tpr', format: 'number' },
                { key: 'pl', format: 'currency' },
                { key: 'ed' },
                { key: 'exp', format: 'number' },
                { key: 'pr' },
                { key: 'pp', format: 'number' },
                { key: 'iv', format: 'currency' },
                { key: 'si', format: 'number' },
                { key: 'change', format: 'percentage' }
            ];

            columns.forEach(col => {
                const cell = document.createElement('td');
                cell.className = 'text-center';
                cell.style.padding = '4px 2px';
                cell.style.border = '1px solid #4a5568';
                cell.style.fontSize = '10px';

                let cellContent = signal[col.key] || '';
                let bgColor = '';

                // Format cell content
                if (col.format === 'percentage' && typeof cellContent === 'number') {
                    bgColor = cellContent >= 0 ? '#16a085' : '#e74c3c';
                    cellContent = `${cellContent >= 0 ? '+' : ''}${cellContent.toFixed(2)}%`;
                    cell.style.color = 'white';
                    cell.style.fontWeight = 'bold';
                } else if (col.format === 'currency' && typeof cellContent === 'number') {
                    cellContent = cellContent.toFixed(2);
                } else if (col.format === 'number' && typeof cellContent === 'number') {
                    cellContent = cellContent.toFixed(2);
                }

                if (col.key === 'symbol') {
                    cell.style.color = '#fff';
                    cell.style.fontWeight = 'bold';
                }

                if (col.key === 'pl' && typeof signal[col.key] === 'string' && signal[col.key].includes('-')) {
                    bgColor = '#e74c3c';
                    cell.style.color = 'white';
                    cell.style.fontWeight = 'bold';
                }

                if (bgColor) {
                    cell.style.backgroundColor = bgColor;
                }

                if (col.style) {
                    Object.assign(cell.style, col.style);
                }

                cell.innerHTML = cellContent;
                row.appendChild(cell);
            });

            tbody.appendChild(row);
        });

        document.getElementById('visibleSignalsCount').textContent = this.filteredSignals.length;
        document.getElementById('showingCount').textContent = Math.min(endIndex, this.filteredSignals.length);
        document.getElementById('totalCount').textContent = this.filteredSignals.length;
    }

    updatePagination() {
        const totalPages = Math.ceil(this.filteredSignals.length / this.pageSize);

        document.getElementById('currentPage').textContent = this.currentPage;
        document.getElementById('totalPages').textContent = totalPages;

        document.getElementById('prevBtn').disabled = this.currentPage <= 1;
        document.getElementById('nextBtn').disabled = this.currentPage >= totalPages;
    }

    applyFilters() {
        const signalType = document.getElementById('signalTypeFilter').value;
        const strength = document.getElementById('strengthFilter').value;
        const sector = document.getElementById('sectorFilter').value;
        const minPrice = parseFloat(document.getElementById('minPriceFilter').value) || 0;
        const maxPrice = parseFloat(document.getElementById('maxPriceFilter').value) || Infinity;

        this.filteredSignals = this.signals.filter(signal => {
            return (!signalType || signal.signal === signalType) &&
                   (!strength || signal.strength === strength) &&
                   (!sector || signal.sector === sector) &&
                   (parseFloat(signal.cmp) >= minPrice && parseFloat(signal.cmp) <= maxPrice);
        });

        this.currentPage = 1;
        this.updateSignalCounts();
        this.renderSignalsTable();
        this.updatePagination();
    }

    clearFilters() {
        document.getElementById('signalTypeFilter').value = '';
        document.getElementById('strengthFilter').value = '';
        document.getElementById('sectorFilter').value = '';
        document.getElementById('minPriceFilter').value = '';
        document.getElementById('maxPriceFilter').value = '';

        this.filteredSignals = [...this.signals];
        this.currentPage = 1;
        this.updateSignalCounts();
        this.renderSignalsTable();
        this.updatePagination();
    }

    startAutoRefresh() {
        if (this.refreshInterval) {
            clearInterval(this.refreshInterval);
        }

        if (this.autoRefresh) {
            this.refreshInterval = setInterval(() => {
                this.loadSignals();
            }, 30000); // Refresh every 30 seconds
        }
    }

    stopAutoRefresh() {
        if (this.refreshInterval) {
            clearInterval(this.refreshInterval);
            this.refreshInterval = null;
        }
    }

    showError(message) {
        const tbody = document.getElementById('signalsTableBody');
        tbody.innerHTML = `
            <tr>
                <td colspan="17" class="text-center py-4">
                    <i class="fas fa-exclamation-triangle fa-3x mb-3 text-danger"></i>
                    <h6 class="text-danger">${message}</h6>
                    <button class="btn btn-outline-primary btn-sm mt-2" onclick="signalsManager.loadSignals()">
                        <i class="fas fa-sync me-1"></i>Retry
                    </button>
                </td>
            </tr>
        `;
    }
}

// Global functions
function refreshSignals() {
    window.signalsManager.loadSignals();
}

function applyFilters() {
    window.signalsManager.applyFilters();
}

function clearFilters() {
    window.signalsManager.clearFilters();
}

function previousPage() {
    if (window.signalsManager.currentPage > 1) {
        window.signalsManager.currentPage--;
        window.signalsManager.renderSignalsTable();
        window.signalsManager.updatePagination();
    }
}

function nextPage() {
    const totalPages = Math.ceil(window.signalsManager.filteredSignals.length / window.signalsManager.pageSize);
    if (window.signalsManager.currentPage < totalPages) {
        window.signalsManager.currentPage++;
        window.signalsManager.renderSignalsTable();
        window.signalsManager.updatePagination();
    }
}

function exportSignals() {
    const data = window.signalsManager.filteredSignals;
    const csvContent = "data:text/csv;charset=utf-8," + 
        Object.keys(data[0]).join(",") + "\n" +
        data.map(row => Object.values(row).join(",")).join("\n");

    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", `trading_signals_${new Date().toISOString().split('T')[0]}.csv`);
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {    window.signalsManager = new TradingSignalsManager();
});
</script>
{% endblock %}